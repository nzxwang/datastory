---
title: "R Notebook"
output: 
  html_document: 
    df_print: default
editor_options: 
  chunk_output_type: console
author: "Nick Wang"
---

```{r setup}
library(tidyverse)
library(tidytext)
library(KoNLP)
```

```{r import}
raw_pdf <- pdftools::pdf_text("/micehome/nwang/repos/datastory/misc/어린 왕자.pdf")

tlp <- raw_pdf %>%
  str_flatten() %>%
  str_split("      [\\d\\d|\\d]") %>%
  unlist() %>%
  .[-1] %>%
  str_replace_all("[a-zA-Z\\n]", "") %>%
  str_replace_all("^\\.", "") %>%
  str_trim(side="both")
```

```{r}
tlp <- tlp[1:3]

tlp %>%
  paste0("Chapter", seq(length(.)), ., collapse="") %>%
  str_replace_all("“|”", "") %>%
  str_replace_all("\\.", "\\.Sentence_End") %>%
  str_split("Sentence_End") %>%
  unlist() %>%
  str_trim() %>%
  tibble(text=.) %>%
  mutate(
    chapter=cumsum(str_detect(text,"Chapter\\d")),
    sentence=row_number(),
    text=str_replace_all(text, "Chapter\\d", "")
         ) -> temp
```


```{r}
tibble(text=tlp) %>%
  unnest_tokens(output=word, input=text) %>%
  count(word) %>%
  mutate(proportion = n / sum(n)) %>%
  arrange(desc(n))
```

